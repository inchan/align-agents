# Logs 페이지 E2E 테스트 시나리오

## 1. 개요
이 문서는 `align-agents` 프로젝트의 **Logs 페이지 (`/logs`)** 에 대한 End-to-End (E2E) 테스트 시나리오를 정의합니다.
주요 검증 대상은 로그 히스토리 조회, SSE(Server-Sent Events) 기반 실시간 스트리밍, LogViewer 사용자 인터랙션, 그리고 다양한 연결 상태 및 에러 처리 로직입니다.

## 2. 테스트 환경
*   **테스트 프레임워크**: Playwright
*   **대상 URL**: `http://localhost:5173/logs` (로컬 개발 환경 기준)
*   **API Mocking**:
    *   안정적인 테스트를 위해 `/api/logs/*` 엔드포인트에 대한 네트워크 요청을 가로채어(intercept) 모의 응답(Mock Response)을 사용합니다.
    *   SSE 연결 상태 테스트 시 네트워크 에러 시뮬레이션이 필요합니다.

## 3. 우선순위 정의
| 우선순위 | 설명 |
| :--- | :--- |
| **P0 (Critical)** | 서비스의 핵심 기능. 장애 시 사용자가 기능을 전혀 사용할 수 없음 (스트리밍, 기본 렌더링). |
| **P1 (Major)** | 주요 기능. 장애 시 사용자 경험에 큰 영향을 미침 (필터링, 히스토리, 에러 복구). |
| **P2 (Minor)** | 부가 기능. 장애가 있어도 핵심 업무에는 지장이 없음 (내보내기, UI 편의성). |

## 4. 기능 매트릭스

| 기능 카테고리 | 시나리오 ID | 기능 명 | 우선순위 |
| :--- | :--- | :--- | :--- |
| **Data Loading** | L-001 | 로그 히스토리 초기 로드 | P0 |
| **Streaming** | L-002 | SSE 실시간 로그 수신 | P0 |
| **Streaming** | L-003 | 연결 상태 표시 (Connecting/Connected/Disconnected) | P1 |
| **Streaming** | L-004 | 연결 끊김 시 자동 재연결 (Exponential Backoff) | P1 |
| **Interaction** | L-005 | 로그 일시정지 및 재개 (Pause/Resume) | P1 |
| **Interaction** | L-006 | 로그 필터링 (레벨/검색어) | P1 |
| **Interaction** | L-007 | 로그 초기화 (Clear) | P1 |
| **Export** | L-008 | 로그 내보내기 (JSON/CSV) | P2 |
| **Error Handling** | L-009 | 히스토리 로드 실패 처리 | P1 |
| **Error Handling** | L-010 | 로그 파싱 에러 카운트 | P2 |

---

## 5. 시나리오 상세

### L-001: 로그 히스토리 초기 로드
*   **우선순위**: P0
*   **카테고리**: Data Loading
*   **목적**: 페이지 진입 시 과거 로그 데이터를 정상적으로 가져와 렌더링하는지 확인한다.
*   **전제조건**: `/api/logs/history` API가 10개의 로그 배열을 반환하도록 설정.
*   **테스트 단계**:
    1. Logs 페이지에 접속한다.
    2. `/api/logs/history` 요청이 성공적으로 완료될 때까지 기다린다.
*   **기대 결과**:
    1. LogViewer 컴포넌트 내에 10개의 로그 항목이 표시되어야 한다.
    2. 로딩 인디케이터가 사라져야 한다.

### L-002: SSE 실시간 로그 수신
*   **우선순위**: P0
*   **카테고리**: Streaming
*   **목적**: SSE 연결을 통해 실시간으로 들어오는 로그가 화면에 추가되는지 확인한다.
*   **전제조건**: 페이지 로드 완료 상태.
*   **테스트 단계**:
    1. `/api/logs/stream` 연결을 수립한다.
    2. SSE 이벤트를 통해 새로운 로그 데이터(예: `Level: INFO, Message: New Log`)를 전송한다.
*   **기대 결과**:
    *   기존 로그 리스트의 맨 아래에 새로운 로그가 추가되어야 한다.
    *   일시정지(Pause) 상태가 아닐 때만 스크롤이 최하단으로 자동 이동해야 한다.
    *   Pause 상태에서는 스크롤 위치가 유지되어야 한다.

### L-003: 연결 상태 표시
*   **우선순위**: P1
*   **카테고리**: Streaming
*   **목적**: SSE 연결 상태(Connecting, Connected, Disconnected)가 UI에 올바르게 반영되는지 확인한다.
*   **전제조건**: 없음.
*   **테스트 단계**:
    1. 페이지 접속 직후 상태 표시 배지를 확인한다 (Connecting).
    2. SSE 연결이 성공(Open)되면 배지를 확인한다 (Connected).
    3. 서버 측에서 강제로 연결을 종료한다.
*   **기대 결과**:
    1. 초기: `Connecting` (노란색/회색)
    2. 연결 성공: `Connected` (녹색)
    3. 연결 종료: `Disconnected` 또는 `Reconnecting` (빨간색/주황색)

### L-004: 연결 끊김 시 자동 재연결
*   **우선순위**: P1
*   **카테고리**: Streaming
*   **목적**: 연결 실패 시 Exponential Backoff 전략에 따라 최대 5회 재연결을 시도하는지 확인한다.
*   **전제조건**: `/api/logs/stream` 요청이 실패하도록 설정.
*   **테스트 단계**:
    1. SSE 연결 요청에 대해 네트워크 에러를 발생시킨다.
    2. 첫 번째 재연결 시도까지 기다린다.
    3. 이후 재연결 시도 간격이 늘어나는지 관찰하거나, 최대 재연결 횟수 초과 시 상태를 확인한다.
*   **기대 결과**:
    1. UI에 재연결 시도 중임이 표시되어야 한다.
    2. 설정된 최대 횟수(5회)만큼 재시도 후, 최종적으로 '연결 실패' 상태로 남아야 한다.

### L-005: 로그 일시정지 및 재개
*   **우선순위**: P1
*   **카테고리**: Interaction
*   **목적**: 사용자가 로그 수신을 일시정지하면 화면 업데이트가 멈추고, 재개 시 다시 업데이트되는지 확인한다.
*   **전제조건**: SSE를 통해 지속적으로 로그가 유입되는 상황.
*   **테스트 단계**:
    1. 'Pause' 버튼을 클릭한다.
    2. 새로운 로그 이벤트를 3개 전송한다.
    3. 화면에 새로운 로그가 추가되지 않았는지 확인한다.
    4. 'Resume' 버튼을 클릭한다.
*   **기대 결과**:
    *   Pause 상태에서도 로그는 계속 state에 추가되지만, auto-scroll이 비활성화된다.
    *   Resume 클릭 시 auto-scroll이 재활성화되고 스크롤이 최하단으로 이동한다.
    *   화면 하단 상태 바에 "⏸ Paused" / "● Live" 표시가 변경된다.

### L-006: 로그 필터링
*   **우선순위**: P1
*   **카테고리**: Interaction
*   **목적**: 텍스트 검색 및 로그 레벨 필터가 정상 작동하는지 확인한다.
*   **전제조건**: `INFO`, `ERROR`, `DEBUG` 레벨이 섞인 로그 데이터 존재.
*   **테스트 단계**:
    1. 검색창에 특정 키워드(예: "Database")를 입력한다.
    2. 로그 레벨 드롭다운에서 `ERROR`를 선택한다.
*   **기대 결과**:
    1. 해당 키워드를 포함하고, 레벨이 `ERROR`인 로그만 리스트에 표시되어야 한다.

### L-007: 로그 초기화 (Clear)
*   **우선순위**: P1
*   **카테고리**: Interaction
*   **목적**: 화면에 표시된 로그를 모두 지울 수 있는지 확인한다.
*   **전제조건**: 화면에 로그가 표시된 상태.
*   **테스트 단계**:
    1. 'Clear' (지우기) 버튼을 클릭한다.
*   **기대 결과**:
    1. LogViewer의 로그 리스트가 빈 상태가 되어야 한다.
    2. 이후 들어오는 로그는 정상적으로 0부터 다시 쌓여야 한다.

### L-008: 로그 내보내기 (Export)
*   **우선순위**: P2
*   **카테고리**: Export
*   **목적**: 현재 표시된 로그를 JSON 또는 CSV 형태로 다운로드할 수 있는지 확인한다.
*   **전제조건**: 화면에 로그가 표시된 상태.
*   **테스트 단계**:
    1. 'Export' 버튼을 누르고 'JSON'을 선택한다.
    2. 다운로드 이벤트가 발생하는지 감지한다.
*   **기대 결과**:
    1. 파일 다운로드가 트리거되어야 한다.
    2. 다운로드된 파일 내용에 현재 화면의 로그 데이터가 포함되어야 한다.

### L-009: 히스토리 로드 실패 처리
*   **우선순위**: P1
*   **카테고리**: Error Handling
*   **목적**: 초기 로그 데이터를 가져오는 API가 실패했을 때 적절한 에러 메시지를 보여주는지 확인한다.
*   **전제조건**: `/api/logs/history` 요청이 500 status code를 반환하도록 설정.
*   **테스트 단계**:
    1. 페이지를 새로고침한다.
    2. 에러 UI가 표시되는지 확인한다.
*   **기대 결과**:
    1. "로그를 불러오는 중 오류가 발생했습니다" 등의 에러 메시지(Toast 또는 인라인 알림)가 표시되어야 한다.

### L-010: 로그 파싱 에러 카운트
*   **우선순위**: P2
*   **카테고리**: Error Handling
*   **목적**: 형식이 잘못된 로그 데이터가 들어왔을 때, 전체 앱이 중단되지 않고 파싱 에러 카운트가 증가하는지 확인한다.
*   **전제조건**: SSE 연결 상태.
*   **테스트 단계**:
    1. SSE를 통해 유효하지 않은 JSON 문자열(Malformed JSON)을 전송한다.
    2. 화면 상단의 'Parsing Errors' 카운터(또는 유사 UI)를 확인한다.
*   **기대 결과**:
    1. 앱이 크래시되지 않아야 한다.
    2. 파싱 에러 카운트가 1 증가해야 한다.

### L-011: 1000개 로그 제한 동작 확인
*   **우선순위**: P2
*   **카테고리**: 엣지 케이스 (Edge Case)
*   **목적**: 로그가 1000개를 초과할 때 오래된 로그가 자동 삭제되는지 확인한다.
*   **전제조건**: SSE를 통해 1000개 이상의 로그가 수신되어야 한다.
*   **테스트 단계**:
    1. 1000개 이상의 로그 이벤트를 발생시킨다.
    2. 로그 목록의 총 개수를 확인한다.
    3. 가장 오래된 로그가 삭제되었는지 확인한다.
*   **기대 결과**:
    *   로그 목록은 최대 1000개를 유지한다.
    *   가장 오래된 로그부터 순차적으로 삭제된다.
    *   UI 성능이 저하되지 않는다.

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-12-11 | 초기 작성 - 10개 시나리오 |
| v1.1 | 2025-12-12 | L-002/L-005 동작 명확화, L-011 추가 |
