# Logs UI 시나리오 테스트 (SSE)

## 목차

- [개요](#개요)
- [테스트 환경](#테스트-환경)
- [기능 매트릭스](#기능-매트릭스)
- [우선순위 정의](#우선순위-정의)
- [시나리오 목록](#시나리오-목록)
  - [L-001: 로그 히스토리 초기 로드](#l-001-로그-히스토리-초기-로드)
  - [L-002: SSE 실시간 로그 수신](#l-002-sse-실시간-로그-수신)
  - [L-003: 연결 상태 표시](#l-003-연결-상태-표시)
  - [L-004: 연결 끊김 시 자동 재연결](#l-004-연결-끊김-시-자동-재연결)
  - [L-005: 로그 일시정지 및 재개](#l-005-로그-일시정지-및-재개)
  - [L-006: 로그 필터링](#l-006-로그-필터링)
  - [L-007: 로그 초기화](#l-007-로그-초기화)
  - [L-008: 로그 내보내기](#l-008-로그-내보내기)
  - [L-009: 히스토리 로드 실패 처리](#l-009-히스토리-로드-실패-처리)
  - [L-010: 로그 파싱 에러 카운트](#l-010-로그-파싱-에러-카운트)
  - [L-011: 1000개 로그 제한 동작 확인](#l-011-1000개-로그-제한-동작-확인)
- [엣지 케이스 시나리오](#엣지-케이스-시나리오)
- [테스트 데이터 Setup](#테스트-데이터-setup)
- [테스트 실행 방법](#테스트-실행-방법)
- [버전 이력](#버전-이력)

---

## 개요

이 문서는 align-agents의 **Logs 페이지** UI 시나리오 테스트를 정의합니다.
`LogsPage.tsx` 및 `LogViewer.tsx` 컴포넌트의 SSE 실시간 로그 스트림 및 관련 기능을 커버합니다.

> **범위**: Logs 메뉴 내 기능만 다룹니다. SSE 연결, 히스토리 로드, 필터링, 내보내기 등.

---

## 테스트 환경

- **도구**: Playwright
- **대상 페이지**: `/logs`
- **베이스 URL**: http://localhost:5173
- **API 서버**: http://localhost:3003
- **SSE 엔드포인트**: `/api/logs/stream`
- **History API**: `/api/logs/history`

---

## 기능 매트릭스

| 기능 | 시나리오 번호 | 우선순위 |
|------|---------------|----------|
| 히스토리 초기 로드 | L-001 | P0 |
| SSE 실시간 로그 수신 | L-002 | P0 |
| 연결 상태 표시 | L-003 | P0 |
| 자동 재연결 | L-004 | P1 |
| 일시정지/재개 | L-005 | P1 |
| 로그 필터링 | L-006 | P1 |
| 로그 초기화 | L-007 | P0 |
| 로그 내보내기 | L-008 | P1 |
| 히스토리 로드 실패 처리 | L-009 | P1 |
| 파싱 에러 카운트 | L-010 | P2 |
| 1000개 로그 제한 | L-011 | P1 |

---

## 우선순위 정의

| 우선순위 | 설명 | 릴리즈 기준 |
|----------|------|-------------|
| **P0** | 핵심 기능, 데이터 무결성 | 필수 통과 |
| **P1** | 에러 처리, UX 안전장치 | 권장 통과 |
| **P2** | 부가 기능, 엣지 케이스 | 시간 허용 시 |

---

## 시나리오 목록

### L-001: 로그 히스토리 초기 로드

**우선순위**: P0
**카테고리**: Core

**목적**: 페이지 접속 시 기존 로그 히스토리가 올바르게 로드되는지 확인

**전제 조건**:
- API 서버 실행 중
- History API가 정상 응답

**테스트 단계**:
1. `/logs` 페이지 접속
2. 페이지 로드 대기
3. 로그 목록이 표시되는지 확인
4. Total 카운트가 히스토리 로그 수와 일치하는지 확인

**예상 결과**:
- [ ] 히스토리 로그가 로그 목록에 표시됨
- [ ] 각 로그에 timestamp, level, message 표시
- [ ] category가 있는 경우 `[category]` 형식으로 표시
- [ ] Total 카운트 정확히 표시

**API 검증**:
- [ ] `GET /api/logs/history` 호출 성공 (200)

---

### L-002: SSE 실시간 로그 수신

**우선순위**: P0
**카테고리**: Core

**목적**: SSE를 통해 실시간 로그가 수신되고 표시되는지 확인

**전제 조건**:
- SSE 연결 정상

**테스트 단계**:
1. `/logs` 페이지 접속
2. SSE 연결 확립 대기
3. 서버에서 새 로그 이벤트 전송
4. 로그 목록에 새 로그가 추가되는지 확인
5. 자동 스크롤이 동작하는지 확인

**예상 결과**:
- [ ] 실시간 로그가 즉시 표시됨
- [ ] Total 카운트 자동 증가
- [ ] 자동 스크롤로 최신 로그가 보임
- [ ] 로그 순서가 시간순으로 정렬

**API 검증**:
- [ ] SSE 연결 성공 (`/api/logs/stream`)
- [ ] `data: {json}` 형식의 이벤트 수신

---

### L-003: 연결 상태 표시

**우선순위**: P0
**카테고리**: Core

**목적**: SSE 연결 상태가 UI에 올바르게 표시되는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속
2. 연결 시도 중 상태 확인 (노란색 인디케이터, "connecting")
3. 연결 성공 후 상태 확인 (녹색 인디케이터, "connected")

**예상 결과**:
- [ ] 연결 중: 노란색(yellow) 인디케이터 + "connecting" 텍스트
- [ ] 연결됨: 녹색(green) 인디케이터 + "connected" 텍스트
- [ ] 연결 실패: 빨간색(red) 인디케이터 + "Connection Failed" 텍스트
- [ ] 인디케이터가 헤더 우측에 표시됨

---

### L-004: 연결 끊김 시 자동 재연결

**우선순위**: P1
**카테고리**: Network

**목적**: SSE 연결이 끊겼을 때 자동으로 재연결을 시도하는지 확인

**전제 조건**:
- 초기 연결 성공 후 연결 끊김 시뮬레이션

**테스트 단계**:
1. `/logs` 페이지 접속 및 연결 확립
2. 네트워크 연결 끊김 시뮬레이션
3. 연결 상태가 "connecting"으로 변경되는지 확인
4. 재연결 시도 확인
5. 최대 재시도 횟수(5회) 초과 시 "error" 상태로 변경되는지 확인
6. "Retry Connection" 버튼 표시 확인

**예상 결과**:
- [ ] 연결 끊김 시 자동 재연결 시도
- [ ] Exponential backoff (1s, 2s, 4s, 8s, 16s) 적용
- [ ] 5회 재시도 실패 후 "Connection Failed" 표시
- [ ] "Retry Connection" 버튼 클릭으로 수동 재연결 가능

---

### L-005: 로그 일시정지 및 재개

**우선순위**: P1
**카테고리**: Feature

**목적**: 로그 자동 스크롤을 일시정지하고 재개할 수 있는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속
2. 초기 상태 확인 (Live 표시, Pause 버튼)
3. Pause 버튼 클릭
4. 상태가 Paused로 변경되는지 확인
5. Play 버튼 클릭
6. 상태가 Live로 복원되는지 확인

**예상 결과**:
- [ ] 초기: "● Live" 표시, Pause 아이콘 버튼
- [ ] Pause 후: "⏸ Paused" 표시, Play 아이콘 버튼, 노란색 강조
- [ ] Paused 상태에서도 로그는 계속 수신됨 (스크롤만 멈춤)
- [ ] Play 후: 자동 스크롤 재개

---

### L-006: 로그 필터링

**우선순위**: P1
**카테고리**: Feature

**목적**: 로그 레벨 및 텍스트로 필터링이 작동하는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속 (다양한 레벨의 로그 존재)
2. 레벨 드롭다운에서 "error" 선택
3. error 레벨 로그만 표시되는지 확인
4. "all"로 복원
5. 검색 필드에 텍스트 입력
6. 해당 텍스트 포함 로그만 표시되는지 확인
7. 카테고리 필터 테스트 (존재하는 경우)

**예상 결과**:
- [ ] 레벨 필터: 선택된 레벨의 로그만 표시
- [ ] 검색 필터: 메시지 또는 카테고리에 검색어 포함 로그만 표시
- [ ] 필터 결과 없을 시 "No logs match your filters" 메시지
- [ ] Filtered 카운트 표시 (Total: X | Filtered: Y)

---

### L-007: 로그 초기화

**우선순위**: P0
**카테고리**: Core

**목적**: Clear 버튼으로 모든 로그를 삭제할 수 있는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속 (로그 존재)
2. Total 카운트 확인
3. Clear (휴지통) 버튼 클릭
4. 로그 목록이 비워지는지 확인
5. Empty state 메시지 표시 확인

**예상 결과**:
- [ ] Clear 클릭 시 모든 로그 삭제
- [ ] Total: 0 표시
- [ ] "No logs yet. Perform actions to see logs here." 메시지 표시
- [ ] 새 로그 수신 시 다시 표시됨

---

### L-008: 로그 내보내기

**우선순위**: P1
**카테고리**: Feature

**목적**: 로그를 JSON 또는 CSV로 내보낼 수 있는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속 (로그 존재)
2. Export 버튼 클릭
3. 드롭다운에서 "Export as JSON" 클릭
4. 파일 다운로드 확인
5. 다시 Export 클릭 후 "Export as CSV" 클릭
6. CSV 파일 다운로드 확인

**예상 결과**:
- [ ] JSON Export: `logs-{timestamp}.json` 파일 다운로드
- [ ] CSV Export: `logs-{timestamp}.csv` 파일 다운로드
- [ ] JSON 형식: `[{id, timestamp, level, message, category?}, ...]`
- [ ] CSV 형식: 헤더 + 데이터 행
- [ ] 로그 없을 시 Export 버튼 비활성화

---

### L-009: 히스토리 로드 실패 처리

**우선순위**: P1
**카테고리**: Error

**목적**: 히스토리 API 실패 시 에러가 표시되는지 확인

**테스트 단계**:
1. History API가 500 에러를 반환하도록 설정
2. `/logs` 페이지 접속
3. 에러 메시지 표시 확인

**예상 결과**:
- [ ] "Failed to load log history" 에러 메시지 표시
- [ ] 에러 메시지가 헤더 영역에 빨간색(destructive)으로 표시
- [ ] SSE 연결은 독립적으로 동작 (히스토리 실패해도 실시간 로그 수신 가능)

---

### L-010: 로그 파싱 에러 카운트

**우선순위**: P2
**카테고리**: Error

**목적**: SSE로 수신된 로그가 파싱 실패 시 에러 카운트가 표시되는지 확인

**테스트 단계**:
1. `/logs` 페이지 접속
2. SSE로 잘못된 JSON 형식의 데이터 전송
3. 파싱 에러 카운트 표시 확인

**예상 결과**:
- [ ] 파싱 에러 발생 시 헤더에 "N parse error(s)" 표시
- [ ] 노란색(yellow)으로 경고 표시
- [ ] 잘못된 로그는 목록에 추가되지 않음
- [ ] 유효한 로그는 정상적으로 표시됨

---

### L-011: 1000개 로그 제한 동작 확인

**우선순위**: P1
**카테고리**: Performance

**목적**: 로그가 1000개를 초과하면 오래된 로그가 삭제되는지 확인

**테스트 단계**:
1. 1000개의 로그가 있는 상태로 시작
2. Total: 1000 확인
3. 새 로그 수신
4. Total이 여전히 1000인지 확인
5. 새 로그가 목록에 있는지 확인
6. 가장 오래된 로그가 삭제되었는지 확인

**예상 결과**:
- [ ] 로그 수가 1000개를 초과하지 않음
- [ ] 새 로그 추가 시 가장 오래된 로그 삭제 (FIFO)
- [ ] UI 성능 저하 없음
- [ ] 메모리 사용량 안정적

---

## 엣지 케이스 시나리오

### L-E01: 빈 로그 상태

**테스트 단계**:
1. 히스토리 없이 페이지 접속
2. Empty state 확인

**예상 결과**:
- [ ] "No logs yet. Perform actions to see logs here." 표시

### L-E02: 필터 결과 없음

**테스트 단계**:
1. 존재하지 않는 텍스트로 검색

**예상 결과**:
- [ ] "No logs match your filters" 표시

### L-E03: 카테고리 필터

**테스트 단계**:
1. 카테고리 드롭다운에서 특정 카테고리 선택

**예상 결과**:
- [ ] 선택된 카테고리의 로그만 표시
- [ ] 카테고리 뱃지로 현재 필터 표시
- [ ] x 클릭으로 필터 해제

---

## 테스트 데이터 Setup

테스트 실행 전 다음이 준비되어야 합니다:

```typescript
// 테스트용 샘플 로그
const sampleLogs = [
    { id: '1', timestamp: '2025-12-13T10:00:00Z', level: 'info', message: 'Server started', category: 'server' },
    { id: '2', timestamp: '2025-12-13T10:00:01Z', level: 'warn', message: 'High memory usage', category: 'system' },
    { id: '3', timestamp: '2025-12-13T10:00:02Z', level: 'error', message: 'Connection failed', category: 'network' },
    { id: '4', timestamp: '2025-12-13T10:00:03Z', level: 'debug', message: 'Debug info', category: 'debug' },
]
```

**SSE Mock 설정**:
```typescript
// Playwright route를 통한 SSE Mock
await page.route('**/api/logs/stream', async (route) => {
    // ReadableStream으로 SSE 응답 시뮬레이션
})
```

---

## 테스트 실행 방법

```bash
# Logs E2E 테스트 실행
cd packages/web
npm run test:e2e -- --grep "Logs"

# 특정 시나리오만 실행
npm run test:e2e -- --grep "L-001"

# 우선순위별 실행 (grep 패턴 사용)
npm run test:e2e -- --grep "L-00[1237]" # P0만

# UI 모드로 실행
npm run test:e2e:ui

# 디버그 모드
npm run test:e2e:debug
```

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-12-13 | 초기 작성 - 11개 시나리오 (RB-48) |
|     |            | - Core: L-001, L-002, L-003, L-007 (4개) |
|     |            | - Network: L-004 (1개) |
|     |            | - Feature: L-005, L-006, L-008, L-011 (4개) |
|     |            | - Error: L-009, L-010 (2개) |
|     |            | - 우선순위 체계 도입 (P0/P1/P2) |
|     |            | - SSE Mock 유틸리티 포함 |
