# Sync 페이지 E2E 테스트 시나리오

## 1. 개요
이 문서는 align-agents의 **Sync 페이지(`/sync`)**에 대한 End-to-End 테스트 시나리오를 정의합니다. 사용자가 동기화 대상 도구(Tool Set)를 선택 또는 생성하고, 규칙(Rules)과 MCP 설정을 지정하여 동기화 작업을 수행하는 전체 워크플로우를 검증합니다.

## 2. 테스트 환경
*   **Framework**: Playwright
*   **Base URL**: `http://localhost:5173`
*   **Target Route**: `/sync`
*   **Data Storage**: LocalStorage (Custom Tool Set), Mock API (Rules, MCP Sets)

## 3. 우선순위 정의 (Priorities)
*   **P0 (Critical)**: 핵심 기능. 동기화 실행, 기본 도구 세트 선택.
*   **P1 (Major)**: 주요 기능. 커스텀 세트 생성/삭제, 에러 처리, 유효성 검사.
*   **P2 (Minor)**: 부가 기능. 자동 스캔 트리거, UI 상태 표시 디테일.

## 4. 기능 매트릭스

| 기능 ID | 기능명 | 시나리오 ID | 우선순위 |
| :--- | :--- | :--- | :--- |
| F-01 | 페이지 초기화 및 로드 | S-001 | P0 |
| F-02 | 기본 Tool Set 선택 | S-002 | P0 |
| F-03 | 커스텀 Tool Set 관리 | S-003, S-003-A, S-004 | P1 |
| F-04 | Rules 및 MCP 선택 | S-005, S-006 | P0 |
| F-05 | 동기화 실행 (성공) | S-007 | P0 |
| F-06 | 동기화 실행 (실패/에러) | S-008 | P1 |
| F-07 | 자동 스캔 (Auto Scan) | S-009 | P2 |

---

## 5. 시나리오 목록

### S-001: Sync 페이지 진입 및 초기 상태 확인
*   **우선순위**: P0
*   **카테고리**: 조회 (Read)
*   **목적**: 페이지 진입 시 필수 컴포넌트(Tool Set 선택, Rules/MCP 드롭다운, Sync 버튼)가 정상적으로 렌더링되는지 확인한다.
*   **전제조건**: 백엔드 API 서버(또는 Mock)가 실행 중이어야 한다.
*   **테스트 단계**:
    1. `/sync` 페이지로 이동한다.
    2. Tool Set 선택 영역(탭 또는 라디오 버튼)이 표시되는지 확인한다.
    3. Rules 선택 드롭다운과 MCP Set 선택 드롭다운이 활성화 상태인지 확인한다.
    4. 'Sync' 버튼이 초기 상태(활성/비활성 여부 확인)로 표시되는지 확인한다.
*   **기대 결과**:
    *   페이지 로드 에러 없이 모든 주요 섹션이 표시된다.
    *   `fetchRulesList`, `fetchMcpSets` API 호출이 발생한다.

### S-002: 기본 Tool Set 변경 확인
*   **우선순위**: P0
*   **카테고리**: 선택 (Interaction)
*   **목적**: 제공된 기본 도구 세트(All Tools, CLI Tools 등) 간의 전환이 정상적으로 동작하는지 확인한다.
*   **전제조건**: 없음.
*   **테스트 단계**:
    1. 기본 선택된 'All Tools' 외의 다른 세트(예: 'CLI Tools')를 클릭한다.
    2. 선택된 세트가 시각적으로 강조(Active state)되는지 확인한다.
    3. 하단의 도구 목록 미리보기(존재할 경우)가 변경된 필터에 맞춰 갱신되는지 확인한다.
*   **기대 결과**:
    *   선택한 Tool Set으로 UI 상태가 즉시 업데이트된다.

### S-003: 커스텀 Tool Set 생성 및 저장
*   **우선순위**: P1
*   **카테고리**: 생성 (Create/LocalStorage)
*   **목적**: 사용자가 직접 도구 세트를 정의하고 저장(LocalStorage)할 수 있는지 확인한다.
*   **전제조건**: 최소 2개 이상의 도구가 사용 가능 상태여야 한다.
*   **테스트 단계**:
    1. 'Create Custom Set' 버튼(또는 유사 UI)을 클릭한다.
    2. 세트 이름을 입력하고(예: `My Dev Set`), 포함할 도구들을 체크박스 등에서 선택한다.
    3. **[Save]** 버튼을 클릭한다.
    4. 페이지를 새로고침한다.
*   **기대 결과**:
    *   새로 생성한 `My Dev Set`이 Tool Set 목록에 추가되어야 한다.
    *   페이지 새로고침 후에도 해당 세트가 유지되어야 한다(LocalStorage 검증).

### S-003-A: 중복 이름 커스텀 Tool Set 생성 방지
*   **우선순위**: P1
*   **카테고리**: 유효성 검사 (Validation)
*   **목적**: 이미 존재하는 이름으로 커스텀 세트 생성 시 경고를 표시하는지 확인한다.
*   **전제조건**: `My Dev Set`이 이미 존재해야 한다.
*   **테스트 단계**:
    1. 'Create Custom Set' 버튼을 클릭한다.
    2. 이미 존재하는 이름 `My Dev Set`을 입력한다.
    3. **[Save]** 버튼을 클릭한다.
*   **기대 결과**:
    *   "이미 존재하는 이름입니다" 에러 메시지가 표시된다.
    *   저장이 차단되고 API 요청이 전송되지 않는다.

### S-004: 커스텀 Tool Set 삭제
*   **우선순위**: P1
*   **카테고리**: 삭제 (Delete)
*   **목적**: 생성된 커스텀 세트를 삭제하고 목록에서 제거되는지 확인한다.
*   **전제조건**: S-003에서 생성한 `My Dev Set`이 존재해야 한다.
*   **테스트 단계**:
    1. `My Dev Set`을 선택하거나 관리 메뉴를 연다.
    2. **[Delete]** 버튼을 클릭하고 확인 팝업에서 승인한다.
*   **기대 결과**:
    *   Tool Set 목록에서 `My Dev Set`이 즉시 사라진다.
    *   LocalStorage에서도 해당 데이터가 제거된다.

### S-005: Rules 선택 동작 확인
*   **우선순위**: P0
*   **카테고리**: 설정 (Configuration)
*   **목적**: 동기화에 적용할 규칙(Rules)을 드롭다운에서 선택할 수 있는지 확인한다.
*   **전제조건**: `fetchRulesList` API가 유효한 규칙 목록을 반환해야 한다.
*   **테스트 단계**:
    1. Rules 드롭다운을 클릭하여 목록을 펼친다.
    2. 특정 규칙(예: `Default Rules`)을 선택한다.
*   **기대 결과**:
    *   선택한 규칙 이름이 드롭다운에 표시된다.
    *   내부 Store 상태(zustand)에 선택한 규칙 ID가 업데이트된다.

### S-006: MCP Set 선택 동작 확인
*   **우선순위**: P0
*   **카테고리**: 설정 (Configuration)
*   **목적**: MCP 설정을 선택할 수 있는지 확인한다.
*   **전제조건**: `fetchMcpSets` API가 유효한 목록을 반환해야 한다.
*   **테스트 단계**:
    1. MCP Set 드롭다운을 클릭한다.
    2. 특정 MCP 세트(예: `Global MCP`)를 선택한다.
*   **기대 결과**:
    *   선택한 MCP 세트가 UI에 반영된다.

### S-007: 동기화(Sync) 실행 성공 시나리오
*   **우선순위**: P0
*   **카테고리**: 실행 (Execution)
*   **목적**: 모든 설정 완료 후 동기화 프로세스를 정상적으로 트리거하고 완료 피드백을 받는지 확인한다.
*   **전제조건**: Tool Set, Rules, MCP Set이 모두 선택되어 있어야 한다.
*   **테스트 단계**:
    1. 필수 항목들을 모두 선택한다.
    2. **[Sync Now]** 버튼을 클릭한다.
    3. 진행 상태(로딩 인디케이터, 로그 등)가 표시되는지 확인한다.
    4. 완료 후 성공 메시지(Toast 또는 모달)가 뜨는지 확인한다.
*   **기대 결과**:
    *   API 호출(Sync 요청)이 발생한다.
    *   UI가 '진행 중' 상태로 변경되었다가, 완료 후 '성공' 상태로 복귀한다.

### S-008: 동기화 실패 및 에러 처리
*   **우선순위**: P1
*   **카테고리**: 에러 핸들링
*   **목적**: 동기화 과정 중 서버 에러 발생 시 사용자에게 적절히 알리는지 확인한다.
*   **전제조건**: Sync API 호출에 대해 500 에러를 반환하도록 Mocking 한다.
*   **테스트 단계**:
    1. 동기화 버튼을 클릭한다.
    2. 에러 응답을 기다린다.
*   **기대 결과**:
    *   UI가 멈추지 않고 에러 메시지(Toast 또는 Alert)를 표시해야 한다.
    *   사용자가 다시 시도할 수 있는 상태로 버튼이 복구되어야 한다.

### S-009: 도구 미발견 시 자동 스캔(Auto Scan) 트리거
*   **우선순위**: P2
*   **카테고리**: 자동화 (Automation)
*   **목적**: 선택한 도구를 찾을 수 없을 때 시스템이 자동 스캔을 제안하거나 실행하는지 확인한다.
*   **전제조건**: 도구 경로가 유효하지 않은 상태를 시뮬레이션한다.
*   **테스트 단계**:
    1. 경로가 깨진 도구가 포함된 세트를 선택하고 Sync를 시도한다.
    2. 시스템이 도구 미발견을 감지하는지 확인한다.
    3. "도구를 찾을 수 없습니다. 다시 스캔하시겠습니까?" 알림이 표시되는지 확인한다.
    4. 자동 스캔이 트리거되었는지 또는 수동 스캔 버튼이 활성화되었는지 확인한다.
*   **기대 결과**:
    *   Sync가 실패하고 에러 메시지가 표시된다.
    *   사용자에게 도구 재스캔 옵션이 제공된다.

---

## 6. 테스트 실행 방법

```bash
# Sync 페이지 테스트만 실행
npm run test:e2e -- --grep "Sync"

# 또는 파일 지정 실행
npx playwright test e2e/sync/*.spec.ts
```

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-12-11 | 초기 작성 - 9개 시나리오 |
| v1.1 | 2025-12-12 | S-009 보완, S-003-A 추가, 테스트 실행 방법 섹션 추가 |
