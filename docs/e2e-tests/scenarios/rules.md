# Rules UI 시나리오 테스트

## 목차

- [개요](#개요)
- [테스트 환경](#테스트-환경)
- [기능 매트릭스](#기능-매트릭스)
- [우선순위 정의](#우선순위-정의)
- [시나리오 목록](#시나리오-목록)
  - [R-001: Rule 목록 조회](#r-001-rule-목록-조회)
  - [R-002: Rule 선택 및 내용 보기](#r-002-rule-선택-및-내용-보기)
  - [R-003: Rule 생성 - 모달 열기/닫기](#r-003-rule-생성---모달-열기닫기)
  - [R-004: Rule 생성 - 성공 케이스](#r-004-rule-생성---성공-케이스)
  - [R-005: Rule 편집 모드 진입](#r-005-rule-편집-모드-진입)
  - [R-006: Rule 편집 - 저장 성공](#r-006-rule-편집---저장-성공)
  - [R-007: Rule 편집 - 취소](#r-007-rule-편집---취소)
  - [R-008: Rule 삭제 - 확인 다이얼로그](#r-008-rule-삭제---확인-다이얼로그)
  - [R-009: Rule 삭제 - 성공 케이스](#r-009-rule-삭제---성공-케이스)
  - [R-010: 드래그앤드롭 순서 변경](#r-010-드래그앤드롭-순서-변경)
  - [R-011: 에러 처리 - 생성 실패](#r-011-에러-처리---생성-실패)
  - [R-012: 에러 처리 - 저장 실패](#r-012-에러-처리---저장-실패)
  - [R-013: 빈 상태 - Rule 미선택](#r-013-빈-상태---rule-미선택)
- [유효성 검증 시나리오](#유효성-검증-시나리오)
  - [R-014: 빈 이름으로 Rule 생성 시도](#r-014-빈-이름으로-rule-생성-시도)
  - [R-015: 중복 이름으로 Rule 생성 시도](#r-015-중복-이름으로-rule-생성-시도)
  - [R-016: 특수문자/공백만 있는 이름 입력](#r-016-특수문자공백만-있는-이름-입력)
- [엣지 케이스 시나리오](#엣지-케이스-시나리오)
  - [R-017: 긴 Rule 이름 처리](#r-017-긴-rule-이름-처리)
  - [R-018: 빈 Content Rule](#r-018-빈-content-rule)
  - [R-019: Active Rule 기본 선택](#r-019-active-rule-기본-선택)
  - [R-020: 편집 중 다른 Rule 선택 - 미저장 경고](#r-020-편집-중-다른-rule-선택---미저장-경고)
  - [R-021: 드래그앤드롭 - 새로고침 시 초기화 확인](#r-021-드래그앤드롭---새로고침-시-초기화-확인)
- [접근성 시나리오](#접근성-시나리오)
  - [R-022: 키보드 네비게이션](#r-022-키보드-네비게이션)
  - [R-023: 긴 이름 Tooltip 확인](#r-023-긴-이름-tooltip-확인)
- [테스트 데이터 Setup](#테스트-데이터-setup)
- [테스트 실행 방법](#테스트-실행-방법)
- [버전 이력](#버전-이력)

---

## 개요

이 문서는 AI CLI Syncer의 **Rules 관리 페이지** UI 시나리오 테스트를 정의합니다.
`RulesPage.tsx` 컴포넌트의 모든 기능을 커버합니다.

---

## 테스트 환경

- **도구**: Playwright
- **대상 페이지**: `/rules`
- **베이스 URL**: http://localhost:5173
- **API 서버**: http://localhost:3001

---

## 기능 매트릭스

| 기능 | 시나리오 번호 | 우선순위 |
|------|---------------|----------|
| Rule 목록 조회 | R-001 | P0 |
| Rule 선택 및 보기 | R-002 | P0 |
| Rule 생성 | R-003, R-004 | P0 |
| Rule 편집 | R-005, R-006, R-007 | P0 |
| Rule 삭제 | R-008, R-009 | P0 |
| 드래그앤드롭 정렬 | R-010, R-021 | P2 |
| 에러 처리 | R-011, R-012 | P1 |
| 빈 상태 처리 | R-013 | P0 |
| 유효성 검증 | R-014, R-015, R-016 | P0 |
| 엣지 케이스 | R-017, R-018, R-019, R-020 | P1 |
| 접근성 | R-022, R-023 | P2 |

---

## 우선순위 정의

| 우선순위 | 설명 | 릴리즈 기준 |
|----------|------|-------------|
| **P0** | 핵심 기능, 데이터 무결성 | 필수 통과 |
| **P1** | 에러 처리, UX 안전장치 | 권장 통과 |
| **P2** | 부가 기능, 접근성 | 시간 허용 시 |

---

## 시나리오 목록

### R-001: Rule 목록 조회

**우선순위**: P0
**카테고리**: Core

**목적**: Rules 페이지 접속 시 Rule 목록이 올바르게 표시되는지 확인

**전제 조건**:
- API 서버 실행 중
- 최소 1개 이상의 Rule이 존재

**테스트 단계**:
1. `/rules` 페이지 접속
2. 좌측 패널에 "Rules" 헤더 확인
3. Rule 목록이 표시되는지 확인
4. 각 Rule 항목에 이름, 수정일자 표시 확인
5. 드래그 핸들(GripVertical 아이콘) 표시 확인

**예상 결과**:
- [ ] Rule 목록이 좌측 패널에 표시됨
- [ ] 각 항목에 이름과 날짜가 표시됨
- [ ] 드래그 핸들이 각 항목에 표시됨

---

### R-002: Rule 선택 및 내용 보기

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 항목 클릭 시 우측 에디터에 내용이 표시되는지 확인

**전제 조건**:
- 최소 2개 이상의 Rule이 존재

**테스트 단계**:
1. Rules 페이지 접속
2. 첫 번째 Rule 항목 클릭
3. 우측 에디터 영역에 Rule 이름 표시 확인
4. Rule 내용이 `<pre>` 태그 내에 표시되는지 확인
5. "Edit" 버튼이 표시되는지 확인
6. 두 번째 Rule 항목 클릭
7. 에디터 내용이 두 번째 Rule로 변경되는지 확인

**예상 결과**:
- [ ] 선택된 Rule이 하이라이트됨 (border-primary 스타일)
- [ ] 에디터에 선택된 Rule의 이름과 내용이 표시됨
- [ ] Rule 전환 시 내용이 즉시 업데이트됨

---

### R-003: Rule 생성 - 모달 열기/닫기

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 생성 모달의 기본 동작 확인

**테스트 단계**:
1. Rules 페이지 접속
2. 좌측 패널의 "+" 버튼 클릭
3. "Create New Rule" 모달이 표시되는지 확인
4. 모달에 "Rule Name", "Content" 입력 필드 확인
5. "Cancel" 버튼 클릭
6. 모달이 닫히는지 확인

**예상 결과**:
- [ ] "+" 버튼 클릭 시 모달 표시
- [ ] 모달에 필수 입력 필드 존재
- [ ] Cancel 클릭 시 모달 닫힘

---

### R-004: Rule 생성 - 성공 케이스

**우선순위**: P0
**카테고리**: Core

**목적**: 새 Rule 생성이 정상적으로 작동하는지 확인

**테스트 단계**:
1. Rules 페이지 접속
2. "+" 버튼 클릭하여 모달 열기
3. Rule Name 입력: `Test Rule 001`
4. Content 입력:
   ```markdown
   # Test Content

   This is a test rule for validation.

   ## Guidelines
   - Follow coding standards
   - Write clean code
   ```
5. "Create" 버튼 클릭
6. 토스트 메시지 확인: "Rule created successfully"
7. 모달이 닫히는지 확인
8. 좌측 목록에 새 Rule이 추가되는지 확인
9. 새 Rule이 자동으로 선택되는지 확인
10. 우측 패널에 생성된 Rule 내용이 표시되는지 확인

**예상 결과**:
- [ ] Rule 생성 성공
- [ ] 토스트 메시지 표시
- [ ] 목록에 새 Rule 추가
- [ ] 생성된 Rule이 자동 선택됨
- [ ] 편집 모드로 전환되어 즉시 수정 가능

---

### R-005: Rule 편집 모드 진입

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 편집 모드 진입이 정상 작동하는지 확인

**전제 조건**:
- 최소 1개의 Rule이 존재

**테스트 단계**:
1. Rules 페이지 접속
2. Rule 항목 클릭하여 선택
3. 우측 에디터의 "Edit" 버튼 클릭
4. 편집 모드로 전환되는지 확인
5. Name 입력 필드에 현재 이름이 표시되는지 확인
6. Content Textarea에 현재 내용이 표시되는지 확인
7. "Save", "Cancel" 버튼이 표시되는지 확인

**예상 결과**:
- [ ] 편집 모드 UI로 전환
- [ ] 기존 이름과 내용이 입력 필드에 로드됨
- [ ] Save/Cancel 버튼 표시

---

### R-006: Rule 편집 - 저장 성공

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 편집 후 저장이 정상 작동하는지 확인

**테스트 단계**:
1. Rules 페이지 접속
2. Rule 선택 후 "Edit" 클릭
3. Name 필드 수정: 기존 이름 + " (Updated)"
4. Content 필드 수정: 내용 끝에 `\n\n## Updated Section\nThis section was added.` 추가
5. "Save" 버튼 클릭
6. 토스트 메시지 확인: "Rule saved successfully"
7. 읽기 모드로 복귀하는지 확인
8. 변경된 이름과 내용이 반영되는지 확인

**예상 결과**:
- [ ] 저장 성공 토스트 표시
- [ ] 편집 모드 종료
- [ ] 변경 사항이 UI에 반영됨

---

### R-007: Rule 편집 - 취소

**우선순위**: P1
**카테고리**: Core

**목적**: Rule 편집 취소 시 변경 사항이 폐기되는지 확인

**테스트 단계**:
1. Rules 페이지 접속
2. Rule 선택 후 "Edit" 클릭
3. Name과 Content 수정
4. "Cancel" 버튼 클릭 (X 아이콘)
5. 읽기 모드로 복귀하는지 확인
6. 원래 내용이 표시되는지 확인

**예상 결과**:
- [ ] 편집 모드 종료
- [ ] 변경 사항이 폐기됨
- [ ] 원래 내용 유지

---

### R-008: Rule 삭제 - 확인 다이얼로그

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 삭제 시 확인 다이얼로그가 표시되는지 확인

**전제 조건**:
- 최소 1개의 Rule이 존재

**테스트 단계**:
1. Rules 페이지 접속
2. Rule 항목에 마우스 호버
3. 삭제 버튼(Trash2 아이콘)이 표시되는지 확인
4. 삭제 버튼 클릭
5. "Delete Rule" 확인 다이얼로그 표시 확인
6. 다이얼로그에 Rule 이름이 표시되는지 확인: `"ruleName"을 삭제하시겠습니까?`
7. "Cancel" 버튼 클릭
8. 다이얼로그가 닫히고 Rule이 유지되는지 확인

**예상 결과**:
- [ ] 호버 시 삭제 버튼 표시
- [ ] 확인 다이얼로그에 Rule 이름 표시
- [ ] "This action cannot be undone" 경고 문구 표시
- [ ] Cancel 시 삭제 취소

---

### R-009: Rule 삭제 - 성공 케이스

**우선순위**: P0
**카테고리**: Core

**목적**: Rule 삭제가 정상적으로 작동하는지 확인

**전제 조건**:
- 삭제 가능한 Rule이 존재 (테스트용 Rule 생성 권장)

**테스트 단계**:
1. Rules 페이지 접속
2. 삭제할 Rule의 삭제 버튼 클릭
3. 확인 다이얼로그에서 "Delete" 버튼 클릭
4. 토스트 메시지 확인: "Rule deleted successfully"
5. 좌측 목록에서 Rule이 제거되는지 확인
6. 삭제된 Rule이 선택 상태였다면 선택이 해제되는지 확인

**예상 결과**:
- [ ] 삭제 성공 토스트 표시
- [ ] 목록에서 Rule 제거
- [ ] UI 상태 정상 업데이트

---

### R-010: 드래그앤드롭 순서 변경

**우선순위**: P2
**카테고리**: Feature

**목적**: Rule 목록의 드래그앤드롭 정렬이 작동하는지 확인

**전제 조건**:
- 최소 3개 이상의 Rule이 존재

**테스트 단계**:
1. Rules 페이지 접속
2. 첫 번째 Rule의 드래그 핸들(GripVertical) 클릭 & 홀드
3. 세 번째 위치로 드래그
4. 드롭하여 놓기
5. 토스트 메시지 확인: "Rule order updated"
6. 순서가 변경되었는지 확인

**예상 결과**:
- [ ] 드래그 중 시각적 피드백 (opacity 0.5 변경)
- [ ] 드롭 후 순서 변경
- [ ] 성공 토스트 표시

**알려진 제한사항**:
- 현재 순서 변경은 클라이언트 상태만 업데이트됨
- 페이지 새로고침 시 초기화됨 (R-021에서 검증)
- TODO: API 연동 필요

---

### R-011: 에러 처리 - 생성 실패

**우선순위**: P1
**카테고리**: Error

**목적**: Rule 생성 실패 시 에러 메시지가 표시되는지 확인

**테스트 단계**:
1. API 서버 중지 또는 네트워크 차단
2. Rules 페이지에서 새 Rule 생성 시도
3. "Create" 버튼 클릭
4. 에러 토스트 메시지 확인: "Failed to create: ..."

**예상 결과**:
- [ ] 에러 토스트 메시지 표시
- [ ] 모달 유지 (재시도 가능)
- [ ] 입력한 데이터 유지

---

### R-012: 에러 처리 - 저장 실패

**우선순위**: P1
**카테고리**: Error

**목적**: Rule 저장 실패 시 에러 메시지가 표시되는지 확인

**테스트 단계**:
1. Rule 편집 모드 진입
2. API 서버 중지 또는 네트워크 차단
3. "Save" 버튼 클릭
4. 에러 토스트 메시지 확인: "Failed to save: ..."

**예상 결과**:
- [ ] 에러 토스트 메시지 표시
- [ ] 편집 모드 유지 (재시도 가능)
- [ ] 수정한 데이터 유지

---

### R-013: 빈 상태 - Rule 미선택

**우선순위**: P0
**카테고리**: Core

**목적**: Rule이 선택되지 않았을 때 적절한 안내가 표시되는지 확인

**테스트 단계**:
1. 모든 Rule 삭제 또는 초기 상태에서 시작
2. Rules 페이지 접속
3. 우측 에디터 영역 확인

**예상 결과**:
- [ ] "Select a rule to view" 메시지 표시
- [ ] FileText 아이콘과 함께 안내 UI 표시

---

## 유효성 검증 시나리오

### R-014: 빈 이름으로 Rule 생성 시도

**우선순위**: P0
**카테고리**: Validation

**목적**: 유효성 검증 확인

**테스트 단계**:
1. 생성 모달 열기
2. Name 필드 비워두기
3. Content만 입력
4. "Create" 버튼 상태 확인

**예상 결과**:
- [ ] "Create" 버튼이 비활성화됨 (disabled)

---

### R-015: 중복 이름으로 Rule 생성 시도

**우선순위**: P0
**카테고리**: Validation

**목적**: 중복 이름 검증이 정상 작동하는지 확인

**전제 조건**:
- "Existing Rule"이라는 이름의 Rule이 이미 존재

**테스트 단계**:
1. 생성 모달 열기
2. Name 필드에 "Existing Rule" 입력 (기존 Rule과 동일)
3. Content 입력
4. "Create" 버튼 클릭
5. 에러 처리 확인

**예상 결과**:
- [ ] 에러 토스트 메시지 표시: "이미 존재하는 이름입니다" 또는 유사 메시지
- [ ] Rule 생성 실패
- [ ] 모달 유지 (이름 수정 가능)

**참고**: 현재 구현 상태에 따라 서버/클라이언트 측 검증 여부 확인 필요

---

### R-016: 특수문자/공백만 있는 이름 입력

**우선순위**: P1
**카테고리**: Validation

**목적**: 특수문자 및 공백 처리 확인

**테스트 단계**:
1. 생성 모달 열기
2. Name 필드에 다음 값들 각각 테스트:
   - `   ` (공백만)
   - `!@#$%^&*()`
   - `<script>alert('xss')</script>`
3. "Create" 버튼 상태 또는 생성 결과 확인

**예상 결과**:
- [ ] 공백만 입력: Create 버튼 비활성화 또는 에러
- [ ] 특수문자: 허용 정책에 따라 처리 (허용 또는 sanitize)
- [ ] XSS 시도: 스크립트가 실행되지 않음 (보안)

---

## 엣지 케이스 시나리오

### R-017: 긴 Rule 이름 처리

**우선순위**: P2
**카테고리**: Edge

**목적**: 긴 이름이 UI에서 올바르게 처리되는지 확인

**테스트 단계**:
1. 50자 이상의 긴 이름으로 Rule 생성: `This is a very long rule name that should be truncated in the UI display`
2. 좌측 목록에서 표시 확인
3. 우측 에디터 헤더에서 표시 확인

**예상 결과**:
- [ ] 좌측 목록: truncate 스타일로 말줄임 처리 (...)
- [ ] 우측 헤더: 적절히 표시 또는 말줄임
- [ ] Tooltip으로 전체 이름 확인 가능 (R-023에서 상세 검증)

---

### R-018: 빈 Content Rule

**우선순위**: P2
**카테고리**: Edge

**목적**: 내용이 없는 Rule의 표시 확인

**테스트 단계**:
1. Content 없이 Rule 생성 (이름만)
2. 해당 Rule 선택
3. 우측 에디터 영역 확인

**예상 결과**:
- [ ] "No content. Click Edit to add rules." italic 메시지 표시

---

### R-019: Active Rule 기본 선택

**우선순위**: P1
**카테고리**: Edge

**목적**: 페이지 로드 시 Active Rule이 기본 선택되는지 확인

**전제 조건**:
- isActive가 true인 Rule이 존재

**테스트 단계**:
1. Rules 페이지 새로고침
2. 자동으로 선택된 Rule 확인

**예상 결과**:
- [ ] Active Rule이 자동으로 선택됨
- [ ] Active Rule이 없으면 첫 번째 Rule 선택

---

### R-020: 편집 중 다른 Rule 선택 - 미저장 경고

**우선순위**: P0
**카테고리**: Edge / UX Safety

**목적**: 편집 모드에서 다른 Rule 선택 시 미저장 변경에 대한 처리 확인

**테스트 단계**:
1. Rule A 선택 후 편집 모드 진입
2. Content 수정 (저장하지 않음)
3. Rule B 클릭
4. 동작 확인:
   - **Case A**: 확인 다이얼로그 표시 → "Discard" 클릭
   - **Case B**: 즉시 Rule B로 전환 (다이얼로그 없음)
5. Rule A 재선택 시 원본 Content 유지 확인

**예상 결과 (현재 구현)**:
- [ ] 편집 모드 종료 (`setIsEditing(false)`)
- [ ] Rule B 내용이 읽기 모드로 표시
- [ ] Rule A의 미저장 변경 사항 폐기

**권장 개선사항**:
- 미저장 변경 시 확인 다이얼로그 표시: "저장하지 않은 변경사항이 있습니다. 계속하시겠습니까?"
- "저장", "저장 안 함", "취소" 옵션 제공

---

### R-021: 드래그앤드롭 - 새로고침 시 초기화 확인

**우선순위**: P2
**카테고리**: Edge (Negative Test)

**목적**: 드래그앤드롭 순서 변경이 서버에 저장되지 않음을 확인

**전제 조건**:
- 최소 3개의 Rule 존재
- R-010 드래그앤드롭 실행 완료

**테스트 단계**:
1. R-010 실행하여 순서 변경
2. 페이지 새로고침 (F5)
3. Rule 목록 순서 확인

**예상 결과**:
- [ ] 순서가 원래대로 복원됨 (초기화)
- [ ] 이는 현재 **알려진 제한사항**임

---

## 접근성 시나리오

### R-022: 키보드 네비게이션

**우선순위**: P2
**카테고리**: Accessibility

**목적**: 키보드만으로 주요 기능 사용 가능 여부 확인

**테스트 단계**:
1. Rules 페이지 접속
2. Tab 키로 Rule 목록 탐색
3. Enter 키로 Rule 선택
4. Tab 키로 "Edit" 버튼 포커스
5. Enter 키로 편집 모드 진입
6. Esc 키로 편집 취소

**예상 결과**:
- [ ] Tab으로 요소 간 이동 가능
- [ ] Enter로 선택/실행 가능
- [ ] Esc로 모달/편집 취소 가능
- [ ] 포커스 표시가 시각적으로 명확함

---

### R-023: 긴 이름 Tooltip 확인

**우선순위**: P2
**카테고리**: Accessibility

**목적**: 말줄임 처리된 긴 이름의 전체 내용을 Tooltip으로 확인 가능한지 검증

**전제 조건**:
- R-017에서 생성한 긴 이름의 Rule 존재

**테스트 단계**:
1. 좌측 목록에서 긴 이름 Rule 항목에 마우스 호버
2. Tooltip 표시 여부 확인
3. Tooltip에 전체 이름이 표시되는지 확인

**예상 결과**:
- [ ] 호버 시 Tooltip 표시
- [ ] Tooltip에 전체 이름 표시
- [ ] `title` 속성 또는 커스텀 Tooltip 컴포넌트 사용

---

## 테스트 데이터 Setup

테스트 실행 전 다음 데이터가 준비되어야 합니다:

```
테스트용 Rule 3개 사전 생성:
- "Default Rule" (isActive: true)
- "Test Rule A"
- "Test Rule B"

API Mock 서버 또는 테스트 DB 초기화 스크립트 준비
```

**Setup 스크립트 예시**:
```bash
# 테스트 데이터 초기화
npm run test:setup

# E2E 테스트 실행
npm run test:e2e
```

---

## 테스트 실행 방법

```bash
# E2E 테스트 실행
cd packages/web
npm run test:e2e

# 특정 시나리오만 실행
npm run test:e2e -- --grep "R-001"

# 우선순위별 실행
npm run test:e2e -- --grep "P0"

# UI 모드로 실행
npm run test:e2e:ui
```

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-12-08 | 초기 작성 - 18개 시나리오 |
| 1.1 | 2025-12-08 | AI 에이전트 리뷰 반영 - 23개 시나리오로 확장 |
|     |            | - R-015 중복 이름 검증 추가 (P0) |
|     |            | - R-016 특수문자/공백 검증 추가 (P1) |
|     |            | - R-020 미저장 경고 시나리오 강화 (P0) |
|     |            | - R-021 드래그앤드롭 Negative Test 추가 (P2) |
|     |            | - R-022 키보드 네비게이션 추가 (P2) |
|     |            | - R-023 Tooltip 검증 추가 (P2) |
|     |            | - 우선순위 체계 도입 (P0/P1/P2) |
|     |            | - 테스트 데이터 Setup 섹션 추가 |
|     |            | - 예상 결과 체크리스트 형식으로 변경 |
